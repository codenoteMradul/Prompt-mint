<div class="mb-6">
  <%= link_to "← Back to Dashboard", dashboard_path, class: "text-sm text-slate-400 hover:text-white transition-colors duration-300" %>

  <div class="mt-4 flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-white"><%= @bundle.title %></h1>
      <p class="mt-2 text-sm text-slate-300"><%= @bundle.description %></p>
      <div class="mt-3 flex flex-wrap items-center gap-2 text-sm text-slate-400">
        <span class="rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-slate-200"><%= @bundle.category.titleize %></span>
        <span class="font-semibold text-white">$<%= @bundle.price %></span>
        <span class="rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-slate-200"><%= @bundle.prompts.size %> prompts included</span>
        <% if @owner %>
          <span class="rounded-full bg-white/5 px-3 py-1 text-xs text-slate-300">Owner</span>
        <% elsif @unlocked %>
          <span class="rounded-full bg-emerald-500/10 px-3 py-1 text-xs text-emerald-200">Unlocked</span>
        <% else %>
          <span class="rounded-full bg-amber-500/10 px-3 py-1 text-xs text-amber-200">Locked</span>
        <% end %>
      </div>
    </div>

    <% unless @owner || @unlocked %>
      <%= button_to "Unlock Bundle", bundle_bundle_purchases_path(@bundle), method: :post, form_class: "inline-flex", class: "inline-flex items-center justify-center rounded-2xl bg-gradient-to-r from-fuchsia-500 via-pink-500 to-cyan-400 px-5 py-3 text-sm font-semibold text-black shadow-[0_0_30px_rgba(217,70,239,0.25)] hover:shadow-[0_0_40px_rgba(34,211,238,0.25)] transition-all duration-300" %>
    <% end %>
  </div>
</div>

<div class="rounded-2xl border border-white/10 bg-white/[0.04] p-6 shadow-[0_0_0_1px_rgba(255,255,255,0.03)] backdrop-blur">
  <div class="flex items-center justify-between">
    <h2 class="text-sm font-semibold tracking-wide text-white">Included Prompts</h2>
    <% if @owner || @unlocked %>
      <span class="text-xs text-slate-400">Full access</span>
    <% else %>
      <span class="text-xs text-slate-400">Preview</span>
    <% end %>
  </div>

  <% if @owner || @unlocked %>
    <div class="mt-4 space-y-3">
      <% @bundle.prompts.each_with_index do |prompt, index| %>
        <div class="rounded-2xl border border-white/10 bg-black/20 p-5">
          <div class="flex items-center justify-between gap-3">
            <h3 class="truncate text-sm font-semibold text-white"><%= index + 1 %>. <%= prompt.title %></h3>
          </div>
          <pre class="mt-3 max-h-72 overflow-auto whitespace-pre-wrap rounded-2xl border border-white/10 bg-black/30 p-4 text-sm text-slate-200"><%= prompt.content %></pre>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="mt-4 rounded-2xl border border-white/10 bg-black/20 p-5">
      <div class="text-sm font-semibold text-white">What’s inside</div>
      <ul class="mt-3 space-y-2 text-sm text-slate-200">
        <% @bundle.prompts.first(2).each do |prompt| %>
          <li class="truncate">• <%= prompt.title %></li>
        <% end %>
      </ul>

      <div class="mt-5 overflow-hidden rounded-2xl border border-white/10 bg-black/30 p-4">
        <p class="whitespace-pre-wrap text-sm text-slate-200 blur-sm select-none"><%= truncate(@bundle.prompts.first&.content.to_s, length: 600) %></p>
        <div class="mt-4 h-px w-full bg-white/10"></div>
        <p class="mt-4 whitespace-pre-wrap text-sm text-slate-200 blur-sm select-none"><%= truncate(@bundle.prompts.second&.content.to_s, length: 600) %></p>
      </div>

      <p class="mt-4 text-sm text-slate-400">Unlock to view all prompts and full content.</p>
    </div>
  <% end %>
</div>
