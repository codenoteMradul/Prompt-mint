<div class="mb-8 flex items-start justify-between gap-4">
  <div>
    <h1 class="text-2xl font-semibold tracking-tight text-white">Messages</h1>
    <p class="mt-1 text-sm text-slate-400">Your conversations with creators and buyers.</p>
  </div>
</div>

<% if @conversations.empty? %>
  <div class="rounded-2xl border border-white/10 bg-white/[0.04] p-6 shadow-[0_0_0_1px_rgba(255,255,255,0.03)] backdrop-blur">
    <p class="text-sm text-slate-300">No messages yet.</p>
    <p class="mt-2 text-sm text-slate-400">Open a creator profile and click “Message” to start a conversation.</p>
  </div>
<% else %>
  <div class="space-y-3">
    <% @conversations.each do |other_user, last_message| %>
      <%= link_to conversation_path(other_user), class: "block rounded-2xl border border-white/10 bg-white/[0.04] p-5 shadow-[0_0_0_1px_rgba(255,255,255,0.03)] backdrop-blur transition-all duration-300 hover:border-white/20 hover:bg-white/[0.06]" do %>
        <div class="flex items-center justify-between gap-4">
          <div class="flex min-w-0 items-center gap-3">
            <% if other_user.avatar.attached? %>
              <%= image_tag other_user.avatar, class: "h-10 w-10 rounded-full border border-white/10 object-cover" %>
            <% else %>
              <div class="h-10 w-10 rounded-full border border-white/10 bg-gradient-to-br from-fuchsia-500/30 via-pink-500/20 to-cyan-400/20"></div>
            <% end %>

            <div class="min-w-0">
              <div class="truncate text-sm font-semibold text-white"><%= other_user.name %></div>
              <div class="truncate text-sm text-slate-400"><%= last_message.body %></div>
            </div>
          </div>

          <div class="flex flex-none items-center gap-3">
            <% unread = Message.where(sender_id: other_user.id, recipient_id: current_user.id, read_at: nil).exists? %>
            <% if unread %>
              <span class="rounded-full bg-emerald-500/10 px-3 py-1 text-xs text-emerald-200">New</span>
            <% end %>
            <span class="text-xs text-slate-500"><%= last_message.created_at.strftime("%b %d") %></span>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>

